---
title: "Compare Datasets"
author: "Erika W"
date: '2022-09-14'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=F, message=F}
rm(list = ls())
library(data.table)
library(lubridate)
library(sf)
library(tidyverse)
```

```{r, warning=F, message=F}
# packages b/c accessing private repo
library(gh)
library(httr)
library(gitcreds)
gh::gh_whoami()
```
The final output is not larger as expected, but smaller. Need to find where/how this error arose.

## Compare MAIN output and 30YRS ORIG RR {.tabset}

### 04 OUTPUT: CEDENSURF_Limited_FixedUnits.csv

```{r, warning = F, message = F}

# Load Old Data

tmp <- tempfile()

Limited <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/main/Data/Output/CEDENSURF_Limited_FixedUnits.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
Limited.old <- read_csv(tmp) 

rm(tmp, Limited) #Clean up to avoid overwrite issues

# Load New Data

tmp <- tempfile()

Limited <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/30YRS-OrigRR/Data/Output/CEDENSURF_Limited_FixedUnits.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
Limited.new <- read_csv(tmp) 

rm(tmp, Limited) #Clean up

```

```{r, echo=FALSE}
nrow(Limited.old)
nrow(Limited.new)

min(as.Date(Limited.old$Date))
min(as.Date(Limited.new$Date))
```

**Old Limited Dataset**
- `r nrow(Limited.old)`records
- Dates: `r min(as.Date(Limited.old$Date))` to `r max(as.Date(Limited.old$Date))`

**New Limited Dataset - Expanded Time Frame**
- `r nrow(Limited.new)`records
- Dates: `r min(as.Date(Limited.new$Date))` to `r max(as.Date(Limited.new$Date))`

### 03 OUTPUT: CEDENSURF_Limited.csv

```{r, warning = F, message = F}

# Load Old Data

tmp <- tempfile()

Limited <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/main/Data/Output/CEDENSURF_Limited.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
Limited.old <- read_csv(tmp) 

rm(tmp, Limited) #Clean up to avoid overwrite issues

# Load New Data

tmp <- tempfile()

Limited <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/30YRS-OrigRR/Data/Output/CEDENSURF_Limited.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
Limited.new <- read_csv(tmp) 

rm(tmp, Limited) #Clean up

```

```{r, echo=FALSE}
nrow(Limited.old)
nrow(Limited.new)

min(as.Date(Limited.old$Date)) #10/2009
min(as.Date(Limited.new$Date)) #01/1995
```


**Old Limited Dataset**
- `r nrow(Limited.old)`records
- Dates: `r min(as.Date(Limited.old$Date))` to `r max(as.Date(Limited.old$Date))`

**New Limited Dataset - Expanded Time Frame**
- `r nrow(Limited.new)`records
- Dates: `r min(as.Date(Limited.new$Date))` to `r max(as.Date(Limited.new$Date))`

### 02 OUTPUT: CEDENSURFMOD.csv

```{r, warning = F, message = F}

# Load Old Data

tmp <- tempfile()

CSMod <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/main/Data/Output/CEDENSURFMod.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
CSMod.old <- read_csv(tmp) 

rm(tmp, Limited) #Clean up to avoid overwrite issues

# Load New Data

tmp <- tempfile()

CSMod <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/30YRS-OrigRR/Data/Output/CEDENSURFMod.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
CSMod.new <- read_csv(tmp) 

rm(tmp, Limited) #Clean up

```

```{r, echo=FALSE}
nrow(CSMod.old)
nrow(CSMod.new)

min(as.Date(CSMod.old$Date)) #10/2009
min(as.Date(CSMod.new$Date)) #01/1995
```

**Old CSMod Dataset**
- `r nrow(CSMod.old)`records
- Dates: `r min(as.Date(CSMod.old$Date))` to `r max(as.Date(CSMod.old$Date))`

**New CSMod Dataset - Expanded Time Frame**
- `r nrow(CSMod.new)`records
- Dates: `r min(as.Date(CSMod.new$Date))` to `r max(as.Date(CSMod.new$Date))`


### 01 OUTPUT: SURFMod_SED and SURFMod_water

No issue here - new is larger (or equal as in the case of the sediment sampling), dates are correct
```{r, warning = F, message = F}

# Load Old Data

tmp <- tempfile()

SURF_SED <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/main/Data/Output/SURFMod_SED.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
SURF_SED.old <- read_csv(tmp) 

rm(tmp, Limited) #Clean up to avoid overwrite issues

tmp <- tempfile()

SURF_water <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/main/Data/Output/SURFMod_water.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
SURF_water.old <- read_csv(tmp) 

rm(tmp, Limited) #Clean up to avoid overwrite issues

# Load New Data

tmp <- tempfile()

SURF_SED <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/30YRS-OrigRR/Data/Output/SURFMod_SED.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
SURF_SED.new <- read_csv(tmp) 

rm(tmp, Limited) #Clean up to avoid overwrite issues

tmp <- tempfile()

SURF_water <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/30YRS-OrigRR/Data/Output/SURFMod_water.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
SURF_water.new <- read_csv(tmp) 

rm(tmp, Limited) #Clean up to avoid overwrite issues
```

```{r, echo=FALSE}
nrow(SURF_water.old)
nrow(SURF_water.new)

min(as.Date(SURF_water.old$Date)) #10/2009
min(as.Date(SURF_water.new$Date)) #01/1995

nrow(SURF_SED.old)
nrow(SURF_SED.new)

min(as.Date(SURF_SED.old$Date)) #02/2009
min(as.Date(SURF_SED.new$Date)) #02/1995
```

**Old SURFMod Dataset**
- `r nrow(SURF_water.old)`records
- Dates: `r min(as.Date(SURF_water.old$Date))` to `r max(as.Date(SURF_water.old$Date))`

**New SURFMod Dataset - Expanded Time Frame**
- `r nrow(SURF_water.new)`records
- Dates: `r min(as.Date(SURF_water.new$Date))` to `r max(as.Date(SURF_water.new$Date))`

### 00 OUTPUT: CEDENMOD.csv

Looks like the date expansion did not occur for CEDEN data. Output is constricted and somehow resulting data are fewer for WQ. 

Check source Mikayla pulled and try to re-run? YES THATS THE ISSUE! SKYLER RE-DOWNLOADED THE DATA TO EXPAND THE AVAILABLE DATE RANGE IN THE RAW DATA BACK IN JUNE. NEED TO USE THAT AS THE NEW INPUT. 

```{r, warning = F, message = F}

# Load Old Data

tmp <- tempfile()

Tox <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDEN-mod/main/Data/Output/CEDENMod_Toxicity.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
Tox.old <- read_csv(tmp) 

rm(tmp) #Clean up to avoid overwrite issues

tmp <- tempfile()

WQ <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDEN-mod/main/Data/Output/CEDENMod_WQ.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
WQ.old <- read_csv(tmp) 

rm(tmp) #Clean up to avoid overwrite issues


# Load New Data

tmp <- tempfile()

Tox <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDEN-mod/30YRS-OrigRR/Data/Output/CEDENMod_Toxicity_20OCT2022.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
Tox.new <- read_csv(tmp) 

rm(tmp) #Clean up

tmp <- tempfile()

WQ <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDEN-mod/30YRS-OrigRR/Data/Output/CEDENMod_WQ_20OCT2022.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
WQ.new <- read_csv(tmp) 

rm(tmp) #Clean up to avoid overwrite issues
```

```{r}
nrow(Tox.old)
nrow(Tox.new)

min(as.Date(Tox.old$Date)) #10/2009
min(as.Date(Tox.new$Date)) #10/2009

max(as.Date(Tox.old$Date)) #09/2019
max(as.Date(Tox.new$Date)) #09/2019
```


```{r}
nrow(WQ.old)
nrow(WQ.new)

min(as.Date(WQ.old$Date)) #10/2009
min(as.Date(WQ.new$Date)) #10/2009

max(as.Date(WQ.old$Date)) #09/2019
max(as.Date(WQ.new$Date)) #09/2019
```

### Did the 30YRS run done with expanded regions also fail to use expanded dates?

```{r}
# Load newRR Data

tmp <- tempfile()

Tox <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDEN-mod/30YRS/Data/Output/CEDENMod_Toxicity_26JUN2022.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
Tox.newRR <- read_csv(tmp) 

rm(tmp) #Clean up

tmp <- tempfile()

WQ <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDEN-mod/30YRS/Data/Output/CEDENMod_WQ_26JUN2022.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
WQ.newRR <- read_csv(tmp) 

rm(tmp) #Clean up to avoid overwrite issues
```


```{r}
nrow(WQ.newRR)

min(as.Date(WQ.newRR$Date)) #10/2009

max(as.Date(WQ.newRR$Date)) #09/2019
```

```{r}

nrow(Tox.newRR)

min(as.Date(Tox.newRR$Date)) #10/2009

max(as.Date(Tox.newRR$Date)) #09/2019
```