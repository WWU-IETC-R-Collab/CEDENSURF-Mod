---
title: "Compare Datasets"
author: "Erika W"
date: '2022-09-14'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Compare Old and New {.tabset}

### CEDEN

#### Load Data
```{r}

library(gh)
library(httr)
library(gitcreds)
gh::gh_whoami()

# Load Old CEDENMOD Data

tmp <- tempfile()

CEDENMod <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDEN-mod/main/Data/Output/CEDENMod_Toxicity.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
CEDENMod_OldTox <- read_csv(tmp) 

rm(tmp, CEDENMod) #Clean up to avoid overwrite issues

# Load Old RR

USFE.OLDRR <-  st_read("Data/USFE_RiskRegions_9292020/RiskRegions_DWSC_Update_9292020.shp")%>%
    st_transform(., "NAD83")

st_crs(USFE.OLDRR)


# Load New CEDENMOD Data

tmp <- tempfile()

CEDENMod <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDEN-mod/30YRS/Data/Output/CEDENMod_Toxicity_26JUN2022.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
CEDENMod_Tox <- read_csv(tmp) 

rm(tmp, CEDENMod) #Clean up


# Load NEW Risk Regions
USFE.regions <-  st_read("Data/Subregions/Subregions.shp") %>% 
  rename(Subregion = SUBREGION)

st_crs(USFE.regions) #NAD83
```
#### Details

```{r}
min(as.Date(CEDENMod_OldTox$Date))
min(as.Date(CEDENMod_Tox$Date))
```

#### Plot Data

```{r}

# Convert ToxOld table to sf
CedToxOld.sf <- st_as_sf(CEDENMod_OldTox,
      coords = c("Longitude", "Latitude"), 
                remove = F, # Keep coordinate columns
                crs = "NAD83") # Assumed NAD83 Datum
  
# Convert ToxNew table to sf
CedToxNew.sf <- st_as_sf(CEDENMod_Tox,
      coords = c("Longitude", "Latitude"), 
                remove = F, # Keep coordinate columns
                crs = "NAD83") # Assumed NAD83 Datum,

```

```{r}
# Map Check - Compare RR
ggplot() +
  geom_sf(data = USFE.regions, color = "blue", fill= NA)+
  geom_sf(data = USFE.OLDRR, fill = NA) +
  geom_sf(data = CedToxNew.sf, color = "orange") +
  geom_sf(data = CedToxOld.sf, )
```

### SURF

#### Load Data
```{r}

library(gh)
library(httr)
library(gitcreds)
gh::gh_whoami()

# Load Old CEDENMOD Data

tmp <- tempfile()

SURFMod <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/main/Data/Output/SURFMod_SED.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
SURFMod_OldSed <- read_csv(tmp) 

rm(tmp, SURFMod) #Clean up to avoid overwrite issues

# Load Old RR

USFE.OLDRR <-  st_read("Data/USFE_RiskRegions_9292020/RiskRegions_DWSC_Update_9292020.shp")%>%
    st_transform(., "NAD83")

st_crs(USFE.OLDRR)


# Load New CEDENMOD Data

tmp <- tempfile()

SURFMod <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/30YRS/Data/Output/SURFMod_SED.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
SURFMod_sed <- read_csv(tmp) 

rm(tmp, SURFMod) #Clean up


# Load NEW Risk Regions
USFE.regions <-  st_read("Data/Subregions/Subregions.shp") %>% 
  rename(Subregion = SUBREGION)

st_crs(USFE.regions) #NAD83
```

#### Prep Data

```{r}

# Convert Old table to sf
SURFSedOld.sf<- st_as_sf(SURFMod_OldSed,
      coords = c("Longitude", "Latitude"), 
                remove = F, # Keep coordinate columns
                crs = "NAD83") # Assumed NAD83 Datum

# Convert New table to sf
SURFSedNew.sf<- st_as_sf(SURFMod_sed,
      coords = c("Longitude", "Latitude"), 
                remove = F, # Keep coordinate columns
                crs = "NAD83") # Assumed NAD83 Datum

```

#### Plot Overlay
```{r}

# Map Check - Compare RR
ggplot() +
  geom_sf(data = USFE.regions, color = "blue", fill= NA)+
  geom_sf(data = USFE.OLDRR, fill = NA) +
  geom_sf(data = SURFSedNew.sf, color = "orange") +
  geom_sf(data = SURFSedOld.sf, )
```


To compare:

#### Load Data
```{r, warning = F, message = F}

library(gh)
library(httr)
library(gitcreds)
gh::gh_whoami()

# Load Old Data

tmp <- tempfile()

Limited <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/main/Data/Output/CEDENSURF_Limited_FixedUnits.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
Limited.old <- read_csv(tmp) 

rm(tmp, Limited) #Clean up to avoid overwrite issues

# Load Old RR

USFE.OLDRR <-  st_read("Data/USFE_RiskRegions_9292020/RiskRegions_DWSC_Update_9292020.shp")%>%
    st_transform(., "NAD83")

st_crs(USFE.OLDRR)


# Load New Data

tmp <- tempfile()

Limited <- gh("https://raw.githubusercontent.com/WWU-IETC-R-Collab/CEDENSURF-mod/30YRS-OrigRR/Data/Output/CEDENSURF_Limited_FixedUnits.csv",
                 .token = gh_token(),
                 .destfile = tmp)
  
Limited.new <- read_csv(tmp) 

rm(tmp, Limited) #Clean up

```

#### Summary

**Old Limited Dataset**
- `r nrow(Limited.old)`records
- Dates: `r min(as.Date(Limited.old$Date))` to `r max(as.Date(Limited.old$Date))`

**New Limited Dataset - Expanded Time Frame**
- `r nrow(Limited.new)`records
- Dates: `r min(as.Date(Limited.new$Date))` to `r max(as.Date(Limited.new$Date))`


#### Prep Data

```{r}

# Convert Old table to sf
Limited.old <- st_as_sf(Limited.old,
      coords = c("Longitude", "Latitude"), 
                remove = F, # Keep coordinate columns
                crs = "NAD83") # Assumed NAD83 Datum

# Convert New table to sf
Limited.new<- st_as_sf(Limited.new,
      coords = c("Longitude", "Latitude"), 
                remove = F, # Keep coordinate columns
                crs = "NAD83") # Assumed NAD83 Datum

```

#### Plot Overlay
```{r}

# Map Check - Compare Data + RR
ggplot() +
  geom_sf(data = USFE.OLDRR, fill = NA) +
  geom_sf(data = Limited.new, color = "orange") +
  geom_sf(data = Limited.old, )
```